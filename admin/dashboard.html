<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TEC RIVERA — Multitenant Manager</title>
    <link
      rel="shortcut icon"
      href="../public/assets/images/iconoTEC.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="css/sidebar.css" />
    <!-- Fuente e iconos -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- Chart.js + Day.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/duration.js"></script>
    <script>
      dayjs.extend(dayjs_plugin_duration);
    </script>
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar__brand">
        <div class="brand__logo">
          <img
            src="../public/assets/images/iconoTEC.png"
            alt="Logo tecrivera"
          />
        </div>
        <div class="brand__text">
          <h1>TEC RIVERA</h1>
          <span>Multi-Tenant</span>
        </div>
        <button
          class="sidebar__toggle flecha"
          id="sidebarToggle"
          aria-label="Alternar menú"
        >
          <i class="bx bx-chevrons-left"></i>
        </button>
      </div>

      <div class="sidebar__section">
        <label class="sidebar__label">Tenant actual</label>
        <div class="tenant-switch">
          <button class="tenant-switch__btn" id="currentTenantBtn">
            <i class="bx bx-buildings"></i>
            <span id="currentTenantName">—</span>
            <i class="bx bx-chevron-down chevron"></i>
          </button>
          <div class="tenant-switch__dropdown" id="tenantDropdown" hidden></div>
        </div>
        <button class="btn btn--ghost btn--sm mt-8" id="openCreateTenant">
          <i class="bx bx-plus"></i> Nuevo tenant
        </button>
      </div>

      <nav class="sidebar__nav">
        <a class="nav__item is-active" data-route="dashboard"
          ><i class="bx bx-grid-alt"></i><span>Dashboard</span></a
        >
        <a class="nav__item" data-route="tenants"
          ><i class="bx bx-buildings"></i><span>Tenants</span></a
        >
        <a class="nav__item" data-route="apps"
          ><i class="bx bx-layer"></i><span>Aplicaciones</span></a
        >
        <a class="nav__item" data-route="contracts"
          ><i class="bx bx-time"></i><span>Contratos</span></a
        >
        <a class="nav__item" data-route="modules"
          ><i class="bx bx-cube"></i><span>Módulos</span></a
        >
        <a class="nav__item" data-route="billing"
          ><i class="bx bx-credit-card"></i><span>Facturación</span></a
        >
        <a class="nav__item" data-route="settings"
          ><i class="bx bx-cog"></i><span>Configuración</span></a
        >
        <a class="nav__item" data-route="support"
          ><i class="bx bx-help-circle"></i><span>Soporte</span></a
        >
      </nav>

      <div class="sidebar__footer">
        <div class="kbd">?</div>
        <span>Atajos</span>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <header class="topbar">
        <div class="topbar__actions">
          <!-- Hamburger -->
          <!-- Botón hamburguesa en la topbar -->
          <button class="hamburger only-mobile" id="hamburger">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
          </button>

          <div class="input-group right lupa">
            <input
              id="globalSearch"
              class="input lupa"
              placeholder="Buscar apps, tenants, dominios…"
            />
            <button class="icon-btn lupa" id="doSearch" title="Buscar">
              <i class="bx bx-search"></i>
            </button>
          </div>
          <button
            class="icon-btn action-fast"
            id="quickCreate"
            title="Acción rápida"
          >
            <i class="bx bx-bolt-circle"></i>
          </button>
          <button class="icon-btn" id="notifBtn" title="Notificaciones">
            <i class="bx bx-bell"></i><span class="dot" id="notifDot"></span>
          </button>

          <div class="user-menu">
            <button class="user-btn" id="userBtn">
              <img src="images/perfil.jpg" alt="Usuario" /><span
                class="user__name"
                >Admin</span
              ><i class="bx bx-chevron-down"></i>
            </button>
            <div class="user-dropdown" id="userDropdown" hidden>
              <button class="dropdown__item">
                <i class="bx bx-id-card"></i> Perfil
              </button>
              <button class="dropdown__item">
                <i class="bx bx-shield-quarter"></i> Seguridad
              </button>
              <hr />
              <button class="dropdown__item" id="logoutBtn">
                <i class="bx bx-log-out"></i> Cerrar sesión
              </button>
            </div>
          </div>
        </div>
      </header>

      <div class="container">
        <!-- DASHBOARD -->
        <section class="view is-active" data-view="dashboard">
          <div class="kpis">
            <div class="kpi">
              <div class="icon"><i class="bx bx-buildings"></i></div>
              <div>
                <div class="muted">Tenants</div>
                <div id="kpiTenants" class="h5">0</div>
              </div>
            </div>
            <div class="kpi">
              <div class="icon"><i class="bx bx-layer"></i></div>
              <div>
                <div class="muted">Aplicaciones</div>
                <div id="kpiApps" class="h5">0</div>
              </div>
            </div>
            <div class="kpi">
              <div class="icon"><i class="bx bx-check-circle"></i></div>
              <div>
                <div class="muted">Activas</div>
                <div id="kpiActive" class="h5">0</div>
              </div>
            </div>
            <div class="kpi">
              <div class="icon"><i class="bx bx-pause-circle"></i></div>
              <div>
                <div class="muted">En pausa</div>
                <div id="kpiPaused" class="h5">0</div>
              </div>
            </div>
          </div>

          <div class="cards">
            <div class="card col-8">
              <div class="card__title">
                <h3>Planes contratados por mes</h3>
                <label class="stat-chip"
                  ><input
                    type="checkbox"
                    id="switchBars"
                    style="accent-color: var(--primary); margin-right: 6px"
                  />
                  Acumulado</label
                >
              </div>
              <canvas id="chartPlans" height="110"></canvas>
            </div>

            <div class="card col-4">
              <div class="card__title"><h3>Estado de aplicaciones</h3></div>
              <canvas id="chartStatus" height="160"></canvas>
            </div>

            <div class="card col-12">
              <div class="card__title"><h3>Actividad reciente</h3></div>
              <ul
                id="activityFeed"
                style="
                  list-style: none;
                  display: grid;
                  gap: 8px;
                  margin-top: 6px;
                "
              ></ul>
            </div>
          </div>
        </section>

        <!-- TENANTS -->
        <section class="view" data-view="tenants">
          <div class="section-title">
            <h3>Tenants</h3>
            <span class="stat-chip"
              ><i class="bx bx-cloud"></i> tenant.tecrivera.com</span
            >
            <button class="btn right" id="btnOpenNewTenant">
              <i class="bx bx-plus"></i> Crear
            </button>
          </div>

          <div class="input-group" style="margin-bottom: 10px">
            <input
              id="searchTenants"
              class="input"
              placeholder="Buscar tenant…"
            />
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Dominio base</th>
                  <th>Apps</th>
                  <th>Creado</th>
                  <th class="right">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbTenants"></tbody>
            </table>
          </div>
        </section>

        <!-- APPS -->
        <section class="view" data-view="apps">
          <div class="section-title">
            <h3>Aplicaciones</h3>
            <button class="btn right" id="btnOpenNewApp">
              <i class="bx bx-plus"></i> Nueva
            </button>
          </div>

          <div class="input-group" style="margin-bottom: 10px">
            <input
              id="searchApps"
              class="input"
              placeholder="Buscar aplicaciones…"
            />
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Subdominio</th>
                  <th>Tipo</th>
                  <th>Tenant</th>
                  <th>Estado</th>
                  <th>Módulos</th>
                  <th class="right">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbApps"></tbody>
            </table>
          </div>
        </section>

        <!-- CONTRATOS -->
        <section class="view" data-view="contracts">
          <div class="section-title"><h3>Contratos & tiempo restante</h3></div>
          <div class="input-group" style="margin-bottom: 10px">
            <input
              id="searchContracts"
              class="input"
              placeholder="Buscar por app/tenant…"
            />
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Aplicación</th>
                  <th>Tenant</th>
                  <th>Plan</th>
                  <th>Inicio</th>
                  <th>Fin</th>
                  <th>Restante</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody id="tbContracts"></tbody>
            </table>
          </div>
        </section>

        <!-- MÓDULOS -->
        <section class="view" data-view="modules">
          <div class="section-title">
            <h3>Biblioteca de módulos</h3>
            <div class="right" style="display: flex; gap: 8px">
              <button class="btn btn--ghost" id="btnExportConfig">
                <i class="bx bx-export"></i> Exportar JSON
              </button>
              <label
                class="btn btn--ghost"
                style="
                  display: inline-flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <i class="bx bx-import"></i> Importar JSON
                <input
                  type="file"
                  id="importConfig"
                  hidden
                  accept="application/json"
                />
              </label>
            </div>
          </div>
          <div
            id="modulesLibrary"
            style="display: flex; flex-wrap: wrap; gap: 8px"
          ></div>
        </section>

        <!-- Vistas placeholder (tu menú original) -->
        <section class="view" data-view="menus">
          <div class="placeholder">Cartas (próximo módulo visual)</div>
        </section>
        <section class="view" data-view="orders">
          <div class="placeholder">Pedidos (próximo módulo visual)</div>
        </section>
        <section class="view" data-view="billing">
          <div class="placeholder">Facturación (próximo módulo visual)</div>
        </section>
        <section class="view" data-view="settings">
          <div class="placeholder">Configuración (próximo módulo visual)</div>
        </section>
        <section class="view" data-view="support">
          <div class="placeholder">Soporte (próximo módulo visual)</div>
        </section>
      </div>
    </main>

    <!-- Modales -->
    <dialog class="modal" id="modalTenant">
      <form method="dialog" class="modal__card">
        <h3>Crear tenant</h3>
        <div class="form-grid">
          <div class="form-field">
            <label>Nombre</label>
            <input
              id="tenantNameInput"
              class="input"
              type="text"
              placeholder="Ej. La Pizzería SRL"
              required
            />
          </div>
          <div class="form-field">
            <label>Dominio / subdominio</label>
            <input
              id="tenantDomainInput"
              class="input"
              type="text"
              placeholder="pizza.tenant.tecrivera.com"
              required
            />
          </div>
        </div>
        <menu class="modal__actions">
          <button class="btn btn--ghost" value="cancel">Cancelar</button>
          <button class="btn" id="createTenantConfirm" value="default">
            Crear
          </button>
        </menu>
      </form>
    </dialog>

    <dialog class="modal" id="modalApp">
      <form method="dialog" class="modal__card">
        <h3>Nueva aplicación</h3>
        <div class="form-grid">
          <div class="form-field">
            <label>Tipo</label>
            <select id="appTypeSelect" class="input">
              <option value="landing">Landing Page</option>
              <option value="web">Página Web</option>
            </select>
          </div>
          <div class="form-field">
            <label>Nombre</label>
            <input
              id="appNameInput"
              class="input"
              type="text"
              placeholder="Ej. Landing RoosFood"
              required
            />
          </div>
          <div class="form-field">
            <label>Subdominio</label>
            <div class="input-group">
              <input
                id="appSubInput"
                class="input"
                type="text"
                placeholder="roosfood"
              /><span class="badge">.tecrivera.com</span>
            </div>
          </div>
          <div class="form-field">
            <label>Tenant</label>
            <select id="appTenantSelect" class="input"></select>
          </div>
          <div class="form-field" style="grid-column: 1/-1">
            <label>Módulos</label>
            <div id="appModulesPicker" class="picker-row"></div>
          </div>
          <div class="form-field">
            <label>Plan</label>
            <select id="appPlanSelect" class="input">
              <option value="Básico">Básico (1 mes)</option>
              <option value="Pro">Pro (6 meses)</option>
              <option value="Anual">Anual (12 meses)</option>
            </select>
          </div>
          <div class="form-field">
            <label>Inicio</label>
            <input id="appStartInput" type="date" class="input" />
          </div>
        </div>
        <menu class="modal__actions">
          <button class="btn btn--ghost" value="cancel">Cancelar</button>
          <button class="btn" id="createAppConfirm" value="default">
            Crear
          </button>
        </menu>
      </form>
    </dialog>

    <!-- Modales extra para apps -->
    <dialog class="modal" id="modalManageModules">
      <form method="dialog" class="modal__card">
        <h3>Gestionar módulos de <span id="mmAppName"></span></h3>
        <div id="mmModules" class="picker-row" style="margin-top: 8px"></div>
        <menu class="modal__actions">
          <button class="btn btn--ghost" value="cancel">Cerrar</button>
          <button class="btn" id="btnSaveModules" value="default">
            Guardar
          </button>
        </menu>
      </form>
    </dialog>

    <dialog class="modal" id="modalChangeDomain">
      <form method="dialog" class="modal__card">
        <h3>Cambiar dominio</h3>
        <div class="form-field">
          <label>Subdominio</label>
          <div class="input-group">
            <input
              id="changeDomainInput"
              class="input"
              placeholder="nuevo-subdominio"
            /><span class="badge">.tecrivera.com</span>
          </div>
        </div>
        <menu class="modal__actions">
          <button class="btn btn--ghost" value="cancel">Cancelar</button>
          <button class="btn" id="btnConfirmChangeDomain" value="default">
            Actualizar
          </button>
        </menu>
      </form>
    </dialog>

    <dialog class="modal" id="modalConfirmDelete">
      <form method="dialog" class="modal__card">
        <h3 style="color: var(--danger)">
          <i class="bx bx-error"></i> Eliminar aplicación
        </h3>
        <p>
          ¿Seguro que deseas eliminar <strong id="delAppName"></strong>? Esta
          acción no se puede deshacer.
        </p>
        <menu class="modal__actions">
          <button class="btn btn--ghost" value="cancel">Cancelar</button>
          <button
            class="btn"
            id="btnDeleteApp"
            value="default"
            style="background: linear-gradient(135deg, #b91c1c, #dc2626)"
          >
            Eliminar
          </button>
        </menu>
      </form>
    </dialog>

    <!-- Toasts + Loader -->
    <div
      class="toast-wrap"
      id="toastWrap"
      aria-live="polite"
      aria-atomic="true"
    ></div>
    <div class="loader" id="globalLoader" hidden>
      <div class="spinner"></div>
    </div>

    <!-- Scrim -->

    <div id="scrim" class="scrim" hidden></div>

    <script src="js/sidebar.js"></script>
  </body>
</html>
